(function(e){e.fn.sketchpad=function(t){var n,r,i,s,o=this,u=e.extend({colors:{r:0,g:0,b:0,a:1},started:false,moved:false,width:window.innerWidth+"px",height:window.innerHeight+"px",size:10,lines:[],optionsOpen:false,pixelRatio:1},t);console.log(u);var a={changeColor:function(e,t,n,r){u.colors.r=e,u.colors.g=t,u.colors.b=n,u.colors.a=r},changeSize:function(e,t){if(t===true){console.log(u.size);if(u.size>0&&u.size+e>0){u.size+=e}}else{u.size=e}},init:function(e){console.log(u);var t=null,i=new Image,s="localStorage"in window&&window["localStorage"]!==null;pixelRatio=this.getPixelRatio();n=document.createElement("canvas");o.append(n);n.setAttribute("height",parseInt(o.css("height")));n.setAttribute("width",parseInt(o.css("width")));if(!n.getContext){alert("Your browser does not support Canvas 2D drawing.")}else{r=n.getContext("2d");n.addEventListener("touchstart",this.onTouchStart,false);n.addEventListener("touchmove",this.onTouchMove,false);n.addEventListener("touchend",this.onTouchEnd,false);n.addEventListener("touchcancel",this.onTouchCancel,false);n.addEventListener("mousedown",this.onMouseDown,false)}document.addEventListener("touchmove",function(e){e.preventDefault()},false);window.addEventListener("shake",this.clearCanvas,false);if(s){t=localStorage.getItem("sketchpad");if(t){i.onload=function(){r.drawImage(i,0,0)};i.src=t}}},getPixelRatio:function(){if("devicePixelRatio"in window){return window.devicePixelRatio}return 1},onTouchStart:function(e){e.preventDefault();_.each(e.touches,function(e){u.lines[e.identifier]={x:e.clientX,y:e.clientY}},this);u.moved=false;u.started=true},onTouchMove:function(e){e.preventDefault();if(u.started&&!u.optionsOpen){_.each(e.touches,function(e){console.log(e);var t=e.identifier,n=e.clientX-u.lines[t].x,r=e.clientY-u.lines[t].y,i=a.drawMulti(t,n,r);u.lines[t].x=i.x;u.lines[t].y=i.y},this)}u.moved=true},onTouchEnd:function(e){if(e.touches.length===0){u.lines=[];u.moved=false;u.started=false}},onTouchCancel:function(e){if(e.touches.length===0){u.lines=[];u.moved=false;u.started=false}},onMouseDown:function(e){u.moved=false;u.started=true;n.addEventListener("mousemove",a.onMouseMove,false);n.addEventListener("mouseup",a.onMouseUp,false)},onMouseMove:function(e){if(u.started&&!u.optionsOpen){console.log(e);var t=e.offsetX,n=e.offsetY;a.drawLine(t,n)}u.moved=true},onMouseUp:function(e){a.endDraw();u.moved=false;u.started=false;n.removeEventListener("mousemove",this.onMouseMove,false);n.removeEventListener("mouseup",this.onMouseUp,false)},drawLine:function(e,t){if(!i||!s){i=e;s=t}console.log("x: "+i+", y: "+s);r.lineCap="round";r.lineJoin="round";r.lineWidth=u.size;r.strokeStyle="rgba("+u.colors.r+","+u.colors.g+","+u.colors.b+","+u.colors.a+")";r.globalCompositeOperation="source-over";r.beginPath();r.moveTo(i,s);r.lineTo(e,t);r.stroke();r.closePath();i=e;s=t},endDraw:function(e,t){i=null;s=null},drawMulti:function(e,t,n){r.lineCap="round";r.lineJoin="round";r.lineWidth=u.size;r.strokeStyle="rgba("+u.colors.r+","+u.colors.g+","+u.colors.b+","+u.colors.a+")";r.globalCompositeOperation="source-over";r.beginPath();r.moveTo(u.lines[e].x,u.lines[e].y);r.lineTo(u.lines[e].x+t,u.lines[e].y+n);r.stroke();r.closePath();return{x:u.lines[e].x+t,y:u.lines[e].y+n}},clearCanvas:function(){if(!confirm("Clear the drawing?")){return}n.setAttribute("height",u.height);n.setAttribute("width",u.width);this.saveImageData()}};return a}})(jQuery)